[English](./README.md)

# Obsidian Feishu Fetcher

一个 Obsidian 插件，可以从飞书多维表格（Bitable）中拉取数据，并在你的 Obsidian 知识库中自动创建或更新笔记。

## ✨ 功能特性

-   **多数据源支持**: 可配置多个不同的飞书多维表格作为数据源。
-   **灵活的笔记创建**:
    -   根据表格中的 `Title` 字段作为笔记标题。
    -   使用 `MD` 字段的内容作为笔记内容。
    -   支持通过 `SubFolder` 字段将笔记存放到指定子文件夹中。
    -   支持通过 `Extension` 字段自定义笔记的文件扩展名（默认为 `.md`）。
    -   使用 `UpdatedIn` 字段的内容来提供获取笔记时的日期过滤功能
-   **增量更新**: 可根据记录的最后更新时间拉取数据，避免重复处理。
-   **简单的配置界面**: 提供图形化界面来管理所有数据源，支持导入和导出配置，方便迁移。
-   **命令面板集成**: 为每个数据源自动创建对应的拉取命令，方便快速调用。

---

## 🚀 快速开始

整个配置过程分为两大部分：**飞书端设置**和**Obsidian 端设置**。

### (一) 飞书端设置

在飞书端，你需要创建一个自建应用和一个用于同步的多维表格。

#### 1. 创建飞书自建应用

你需要一个拥有读取多维表格权限的自建应用来获取数据。

1.  访问 [飞书开放平台](https://open.feishu.cn/app) 并登录。
2.  点击 **创建应用**，选择 **企业自建应用**。
3.  填写应用名称（例如：“Obsidian 同步助手”）和描述。
4.  在应用的 **权限管理** 页面，搜索并开通以下权限：
    -   `bitable:app_table:readonly`：读取多维表格的记录。
5.  在 **版本管理与发布** 页面，创建一个新版本并**发布**你的应用。
6.  回到 **凭证与基础信息** 页面，获取并妥善保管你的 **App ID** 和 **App Secret**。这是后续配置插件所必需的。

#### 2. 创建和配置飞书多维表格

这是你的数据来源。你需要创建一个表格并设置必要的字段。

1.  创建一个新的[飞书多维表格](https://feishu.cn/base)。
2.  **【关键】** 在表格中创建以下字段（**字段名称必须完全匹配**）：

    -   `Title` (类型: `文本`): 笔记的标题。
    -   `MD` (类型: `文本`): 笔记的主要内容，支持 Markdown 格式。
    -   `SubFolder` (类型: `文本`, 可选): 用于存放笔记的子文件夹路径。例如，填入 `日记/2025` 会将笔记存放在 `[你的目标路径]/日记/2025` 文件夹下。
    -   `Extension` (类型: `文本`, 可选): 笔记的文件扩展名。如果留空，默认为 `md`。
    -   `UpdatedIn` (类型: `公式字段`): 用于增量同步。插件会根据这个时间戳来判断哪些笔记需要更新。
        -   比如，你可以有一个叫`笔记更新日期`的日期型字段
        -   然后，在`UpdatedIn`字段中，使用`DATEDIF(TODAY(),[笔记更新日期],"days")`，来得到笔记上次更新是几天前

3.  **为表格授权**:

    -   点击表格右上角的 **···** 图标
    -   在出现的面板中选择 **更多**
    -   在弹出的菜单中选择 **添加文档应用**。
    -   搜索并选择你刚刚创建的自建应用，并确保为其配置了 **可编辑** 权限。

4.  **复制表格链接**:
    -   在浏览器中打开你的多维表格。
    -   复制浏览器地址栏中的完整 URL。
    -   **注意**: URL 必须是包含 `base`、`table` 和 `view` 参数的格式，例如：
        ```
        https://feishu.cn/base/BASExxxxxxxxxxxxxxx?table=TBLxxxxxxxxxxxxxx&view=VEWxxxxxxxxxxxxxx
        ```
    -   请勿使用 `wiki` 页面或分享页面中的链接。

### (二) Obsidian 端设置

#### 1. 安装插件

-   推荐使用 [BRAT](https://github.com/TfTHacker/obsidian42-brat) 插件进行安装。
-   在 BRAT 中添加 Beta 插件，输入本插件的 GitHub 仓库地址。

#### 2. 配置插件

1.  在 Obsidian 中启用 Feishu Fetcher 插件。
2.  打开插件设置页面。
3.  点击 **+ 添加新数据源** 来创建一个新的数据源。
4.  在弹出的编辑窗口中填写以下信息：
    -   **数据源名称**: 为你的数据源起一个描述性的名字（例如：“我的读书笔记”）。这个名字会显示在命令面板中。
    -   **数据源 URL**: 粘贴你之前复制的多维表格链接。
    -   **APP ID**: 粘贴你自建应用的 App ID。
    -   **应用密钥**: 粘贴你自建应用的 App Secret。
    -   **目标路径**: 设置一个在 Obsidian 库中的文件夹路径，用来存放从飞书拉取过来的笔记（例如：`Feishu Notes`）。如果文件夹不存在，插件会自动创建。
5.  点击 **保存** 保存设置。

### (三) 如何使用

1.  按下 `Ctrl+P` (或 `Cmd+P`) 打开 Obsidian 的命令面板。
2.  搜索 "Feishu Fetcher"，你会看到为你配置的每个数据源生成的命令，格式为 `获取 [你的数据源名称]`。
3.  选择你想要同步的命令并回车。
4.  插件会提示你选择一个更新时间范围（例如“最近一天内更新的笔记”或“所有笔记”）。
5.  选择后，插件将开始拉取数据，并在你指定的目标路径下创建或更新笔记。

---

## 导入和导出配置

为了方便在不同设备间同步设置，插件提供了导入和导出功能。

-   **导出全部数据源**: 将所有数据源配置（不含 App Secret）导出到剪贴板。
-   **导入数据源**: 从剪贴板中粘贴 JSON 格式的配置来快速添加数据源。
